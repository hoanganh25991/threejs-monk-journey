/**
 * Monk Journey PWA Service Worker
 * Handles caching and updates for the game
 */

const CACHE_NAME = 'monk-journey-cache';
const CACHE_VERSION = '44';
const CACHE_KEY = CACHE_NAME + '-v' + CACHE_VERSION;


// Total cache size in bytes and MB
const TOTAL_CACHE_SIZE_BYTES = 7103093;
const TOTAL_CACHE_SIZE_MB = 6.77;

// Assets to cache
const ASSETS_TO_CACHE = [
  '',
  'manifest.json',
  'css/animations.css',
  'css/camera-control.css',
  'css/death-screen.css',
  'css/dialog.css',
  'css/difficulty-menu.css',
  'css/game-menu.css',
  'css/game.css',
  'css/hud/common.css',
  'css/hud/effects-container.css',
  'css/hud/enemy-health.css',
  'css/hud/joystick.css',
  'css/hud/layout.css',
  'css/hud/minimap.css',
  'css/hud/player-stats.css',
  'css/hud/quest-log.css',
  'css/hud/skills.css',
  'css/hud-manager.css',
  'css/icons.css',
  'css/initial-loading.css',
  'css/inventory.css',
  'css/item-popup.css',
  'css/loading-screen.css',
  'css/main.css',
  'css/multiplayer.css',
  'css/notifications.css',
  'css/orientation-message.css',
  'css/performance-manager.css',
  'css/reset.css',
  'css/settings/base.css',
  'css/settings/buttons.css',
  'css/settings/controls.css',
  'css/settings/enemy-preview.css',
  'css/settings/forms.css',
  'css/settings/item-preview.css',
  'css/settings/mobile.css',
  'css/settings/model-preview.css',
  'css/settings/skills-preview.css',
  'css/settings/tabs.css',
  'css/settings-menu.css',
  'css/skill-preview.css',
  'css/skill-selection.css',
  'css/skill-tree.css',
  'css/teleport-manager.css',
  'css/utilities.css',
  'css/variables.css',
  'js/AudioManager.js',
  'js/CollisionManager.js',
  'js/EffectsManager.js',
  'js/InputHandler.js',
  'js/InteractionResultHandler.js',
  'js/Main.js',
  'js/PerformanceManager.js',
  'js/QuestManager.js',
  'js/UIComponent.js',
  'js/effects/EffectObjectPool.js',
  'js/entities/enemies/Enemy.js',
  'js/entities/enemies/EnemyManager.js',
  'js/entities/enemies/models/CorruptedTreantModel.js',
  'js/entities/enemies/models/DefaultModel.js',
  'js/entities/enemies/models/DemonModel.js',
  'js/entities/enemies/models/EnemyModel.js',
  'js/entities/enemies/models/EnemyModelFactory.js',
  'js/entities/enemies/models/FireElementalModel.js',
  'js/entities/enemies/models/FrostElementalModel.js',
  'js/entities/enemies/models/FrostTitanModel.js',
  'js/entities/enemies/models/InfernalGolemModel.js',
  'js/entities/enemies/models/MountainTrollModel.js',
  'js/entities/enemies/models/NecromancerModel.js',
  'js/entities/enemies/models/ShadowBeastModel.js',
  'js/entities/enemies/models/SimpleEnemyModel.js',
  'js/entities/enemies/models/SkeletonArcherModel.js',
  'js/entities/enemies/models/SkeletonModel.js',
  'js/entities/enemies/models/SwampWitchModel.js',
  'js/entities/enemies/models/VoidWraithModel.js',
  'js/entities/enemies/models/ZombieBruteModel.js',
  'js/entities/enemies/models/ZombieModel.js',
  'js/entities/items/Item.js',
  'js/entities/items/ItemDropManager.js',
  'js/entities/items/ItemGenerator.js',
  'js/entities/items/models/ItemModel.js',
  'js/entities/items/models/ItemModelFactory.js',
  'js/entities/items/models/accessory/AmuletModel.js',
  'js/entities/items/models/armor/HelmetModel.js',
  'js/entities/items/models/armor/RobeModel.js',
  'js/entities/items/models/consumable/PotionModel.js',
  'js/entities/items/models/weapons/DaggerModel.js',
  'js/entities/items/models/weapons/FistModel.js',
  'js/entities/items/models/weapons/StaffModel.js',
  'js/entities/player/Player.js',
  'js/entities/player/PlayerAttackEffect.js',
  'js/entities/player/PlayerCombat.js',
  'js/entities/player/PlayerInventory.js',
  'js/entities/player/PlayerModel.js',
  'js/entities/player/PlayerMovement.js',
  'js/entities/player/PlayerSkills.js',
  'js/entities/player/PlayerState.js',
  'js/entities/player/PlayerStats.js',
  'js/entities/skills/BleedingEffect.js',
  'js/entities/skills/BreathOfHeavenEffect.js',
  'js/entities/skills/BulBreathOfHeavenEffect.js',
  'js/entities/skills/BulPalmEffect.js',
  'js/entities/skills/CycloneStrikeEffect.js',
  'js/entities/skills/DeadlyReachEffect.js',
  'js/entities/skills/ExplodingPalmEffect.js',
  'js/entities/skills/FistOfThunderEffect.js',
  'js/entities/skills/FlyingDragonEffect.js',
  'js/entities/skills/FlyingKickEffect.js',
  'js/entities/skills/ImprisonedFistsEffect.js',
  'js/entities/skills/InnerSanctuaryEffect.js',
  'js/entities/skills/MysticAllyEffect.js',
  'js/entities/skills/SevenSidedStrikeEffect.js',
  'js/entities/skills/ShieldOfZenEffect.js',
  'js/entities/skills/Skill.js',
  'js/entities/skills/SkillEffect.js',
  'js/entities/skills/SkillEffectFactory.js',
  'js/entities/skills/WaveOfLightEffect.js',
  'js/entities/skills/WaveStrikeEffect.js',
  'js/entities/skills/variants/BreathOfHeaven/CircleOfLifeEffect.js',
  'js/entities/skills/variants/BreathOfHeaven/InfusedWithLightEffect.js',
  'js/entities/skills/variants/BreathOfHeaven/RadiantBreathEffect.js',
  'js/entities/skills/variants/BreathOfHeaven/SoothingMistEffect.js',
  'js/entities/skills/variants/BreathOfHeaven/ZephyrsGraceEffect.js',
  'js/entities/skills/variants/BulPalm/BulPalmCrossEffect.js',
  'js/entities/skills/variants/BulPalm/BulPalmRainEffect.js',
  'js/entities/skills/variants/BulPalm/StormOfPalmsEffect.js',
  'js/entities/skills/variants/CycloneStrike/EyeOfTheStormEffect.js',
  'js/entities/skills/variants/CycloneStrike/MysticWindsEffect.js',
  'js/entities/skills/variants/CycloneStrike/PathOfTheStormEffect.js',
  'js/entities/skills/variants/CycloneStrike/SandstormEffect.js',
  'js/entities/skills/variants/CycloneStrike/StormSpiritEffect.js',
  'js/entities/skills/variants/CycloneStrike/TempestRushEffect.js',
  'js/entities/skills/variants/CycloneStrike/TempestsHeartEffect.js',
  'js/entities/skills/variants/CycloneStrike/TornadoEffect.js',
  'js/entities/skills/variants/CycloneStrike/VortexEffect.js',
  'js/entities/skills/variants/CycloneStrike/backup/FrigidCycloneEffect.js',
  'js/entities/skills/variants/ExplodingPalm/BleedingPalmEffect.js',
  'js/entities/skills/variants/ExplodingPalm/BreathOfIncenseEffect.js',
  'js/entities/skills/variants/ExplodingPalm/ConcussivePalmEffect.js',
  'js/entities/skills/variants/ExplodingPalm/CripplingInsightEffect.js',
  'js/entities/skills/variants/ExplodingPalm/FieryPalmEffect.js',
  'js/entities/skills/variants/ExplodingPalm/IcyPalmEffect.js',
  'js/entities/skills/variants/ExplodingPalm/PathOfThePresentEffect.js',
  'js/entities/skills/variants/ExplodingPalm/ReachingRebukeEffect.js',
  'js/entities/skills/variants/ExplodingPalm/ScoldingStormEffect.js',
  'js/entities/skills/variants/ExplodingPalm/ShockingPalmEffect.js',
  'js/entities/skills/variants/FlyingDragon/DragonFlightEffect.js',
  'js/entities/skills/variants/FlyingDragon/GaleDragonEffect.js',
  'js/entities/skills/variants/FlyingDragon/InfernoDragonEffect.js',
  'js/entities/skills/variants/FlyingDragon/ShadowDragonEffect.js',
  'js/entities/skills/variants/FlyingDragon/ThunderDragonEffect.js',
  'js/entities/skills/variants/FlyingKick/BlazingKickEffect.js',
  'js/entities/skills/variants/FlyingKick/CycloneKickEffect.js',
  'js/entities/skills/variants/FlyingKick/GaleKickEffect.js',
  'js/entities/skills/variants/FlyingKick/GracesBountyEffect.js',
  'js/entities/skills/variants/FlyingKick/MantleOfTheCraneEffect.js',
  'js/entities/skills/variants/FlyingKick/MomentumFlowEffect.js',
  'js/entities/skills/variants/FlyingKick/ShadowKickEffect.js',
  'js/entities/skills/variants/FlyingKick/SpokesOfTheWheelEffect.js',
  'js/entities/skills/variants/FlyingKick/ThunderousKickEffect.js',
  'js/entities/skills/variants/FlyingKick/TigersFlightEffect.js',
  'js/entities/skills/variants/ImprisonedFists/FieryChainsEffect.js',
  'js/entities/skills/variants/ImprisonedFists/FrozenShacklesEffect.js',
  'js/entities/skills/variants/ImprisonedFists/GaleChainsEffect.js',
  'js/entities/skills/variants/ImprisonedFists/ShadowBindEffect.js',
  'js/entities/skills/variants/ImprisonedFists/ThunderousGripEffect.js',
  'js/entities/skills/variants/InnerSanctuary/CircleOfWrathEffect.js',
  'js/entities/skills/variants/InnerSanctuary/ForbiddenPalaceEffect.js',
  'js/entities/skills/variants/InnerSanctuary/SafeHavenEffect.js',
  'js/entities/skills/variants/InnerSanctuary/SanctifiedGroundEffect.js',
  'js/entities/skills/variants/InnerSanctuary/TempleOfProtectionEffect.js',
  'js/entities/skills/variants/MysticAllies/FireAlliesEffect.js',
  'js/entities/skills/variants/MysticAllies/WaterAlliesEffect.js',
  'js/entities/skills/variants/SevenSidedStrike/FistOfFuryEffect.js',
  'js/entities/skills/variants/SevenSidedStrike/InnerPeaceEffect.js',
  'js/entities/skills/variants/SevenSidedStrike/PandemoniumEffect.js',
  'js/entities/skills/variants/SevenSidedStrike/ShadowAssaultEffect.js',
  'js/entities/skills/variants/SevenSidedStrike/SustainedAssaultEffect.js',
  'js/entities/skills/variants/ShieldOfZen/DiamondAuraEffect.js',
  'js/entities/skills/variants/ShieldOfZen/RetributionAuraEffect.js',
  'js/entities/skills/variants/ShieldOfZen/SpiritualProtectionEffect.js',
  'js/entities/skills/variants/ShieldOfZen/TranscendenceEffect.js',
  'js/entities/skills/variants/WaveOfLight/ExplosiveLightEffect.js',
  'js/entities/skills/variants/WaveOfLight/LightningBellEffect.js',
  'js/entities/skills/variants/WaveOfLight/LightningBurstEffect.js',
  'js/entities/skills/variants/WaveOfLight/PillarOfTheLightEffect.js',
  'js/entities/skills/variants/WaveOfLight/PillarOfTheSunEffect.js',
  'js/entities/skills/variants/WaveOfLight/WallOfLightEffect.js',
  'js/entities/skills/variants/WaveStrike/FrozenWaveEffect.js',
  'js/entities/skills/variants/WaveStrike/ThunderWaveEffect.js',
  'js/entities/skills/variants/WaveStrike/TidalWaveEffect.js',
  'js/entities/utils/CharacterModelPool.js',
  'js/entities/utils/EnemyObjectPool.js',
  'js/game/Game.js',
  'js/game/GameEvents.js',
  'js/game/GameState.js',
  'js/game/LoadingManager.js',
  'js/game/SceneOptimizer.js',
  'js/hud-manager/CameraControlUI.js',
  'js/hud-manager/DeathScreenUI.js',
  'js/hud-manager/DialogUI.js',
  'js/hud-manager/EnemyUI.js',
  'js/hud-manager/HUDManager.js',
  'js/hud-manager/HomeUI.js',
  'js/hud-manager/InventoryButton.js',
  'js/hud-manager/InventoryUI.js',
  'js/hud-manager/MiniMapButton.js',
  'js/hud-manager/MiniMapUI.js',
  'js/hud-manager/NotificationsUI.js',
  'js/hud-manager/PlayerUI.js',
  'js/hud-manager/QuestLogUI.js',
  'js/hud-manager/SkillSelectionButton.js',
  'js/hud-manager/SkillSelectionUI.js',
  'js/hud-manager/SkillTreeButton.js',
  'js/hud-manager/SkillTreeUI.js',
  'js/hud-manager/SkillsUI.js',
  'js/hud-manager/VirtualJoystickUI.js',
  'js/interaction/InteractionSystem.js',
  'js/menu-system/ControlsDisplay.js',
  'js/menu-system/EnemyPreview.js',
  'js/menu-system/GameMenu.js',
  'js/menu-system/IMenu.js',
  'js/menu-system/ItemPreview.js',
  'js/menu-system/MainBackground.js',
  'js/menu-system/MenuManager.js',
  'js/menu-system/ModelPreview.js',
  'js/menu-system/SettingsMenu.js',
  'js/menu-system/settings-menu/AudioTab.js',
  'js/menu-system/settings-menu/CharacterModelTab.js',
  'js/menu-system/settings-menu/ControlsTab.js',
  'js/menu-system/settings-menu/EnemyPreviewTab.js',
  'js/menu-system/settings-menu/GameplayTab.js',
  'js/menu-system/settings-menu/ItemPreviewTab.js',
  'js/menu-system/settings-menu/PerformanceTab.js',
  'js/menu-system/settings-menu/ReleaseTab.js',
  'js/menu-system/settings-menu/SettingsTab.js',
  'js/menu-system/settings-menu/SkillPreview.js',
  'js/menu-system/settings-menu/SkillsPreviewTab.js',
  'js/multiplayer/BinarySerializer.js',
  'js/multiplayer/MultiplayerConnectionManager.js',
  'js/multiplayer/MultiplayerManager.js',
  'js/multiplayer/MultiplayerUIManager.js',
  'js/multiplayer/RemotePlayer.js',
  'js/multiplayer/RemotePlayerManager.js',
  'js/save-manager/GoogleAuthManager.js',
  'js/save-manager/GoogleDriveAdapter.js',
  'js/save-manager/ISaveSystem.js',
  'js/save-manager/IStorageAdapter.js',
  'js/save-manager/LocalStorageAdapter.js',
  'js/save-manager/SaveManager.js',
  'js/save-manager/StorageService.js',
  'js/save-manager/serializers/InventorySerializer.js',
  'js/save-manager/serializers/PlayerSerializer.js',
  'js/save-manager/serializers/QuestSerializer.js',
  'js/save-manager/serializers/SettingsSerializer.js',
  'js/save-manager/utils/SaveOperationProgress.js',
  'js/utils/AnimationUtils.js',
  'js/utils/SkillTreeUtils.js',
  'js/world/WorldManager.js',
  'js/world/environment/Bush.js',
  'js/world/environment/EnvironmentManager.js',
  'js/world/environment/Flower.js',
  'js/world/environment/FogManager.js',
  'js/world/environment/Rock.js',
  'js/world/environment/SkyManager.js',
  'js/world/environment/Tree.js',
  'js/world/interactive/BossSpawnPoint.js',
  'js/world/interactive/InteractiveObjectManager.js',
  'js/world/interactive/QuestMarker.js',
  'js/world/interactive/TreasureChest.js',
  'js/world/lighting/LightingManager.js',
  'js/world/structures/Bridge.js',
  'js/world/structures/Building.js',
  'js/world/structures/DarkSanctum.js',
  'js/world/structures/Mountain.js',
  'js/world/structures/Ruins.js',
  'js/world/structures/StructureManager.js',
  'js/world/structures/Tower.js',
  'js/world/structures/Village.js',
  'js/world/teleport/PortalModelFactory.js',
  'js/world/teleport/TeleportManager.js',
  'js/world/terrain/TerrainManager.js',
  'js/world/utils/EnvironmentObjectPool.js',
  'js/world/utils/ModelObjectPool.js',
  'js/world/utils/ObjectPool.js',
  'js/world/utils/RandomGenerator.js',
  'js/world/utils/TerrainChunkPool.js',
  'js/world/utils/TextureGenerator.js',
  'js/world/zones/ZoneManager.js',
  'images/home.jpg',
  'images/logo-192.png',
  'images/logo-192.svg',
  'images/logo-512.png',
  'images/logo-512.svg',
  'assets/audio/ally_dismiss.mp3',
  'assets/audio/ally_summon.mp3',
  'assets/audio/attack.mp3',
  'assets/audio/barrier_dissipate.mp3',
  'assets/audio/barrier_form.mp3',
  'assets/audio/battle_theme.mp3',
  'assets/audio/bell_fade.mp3',
  'assets/audio/bell_ring.mp3',
  'assets/audio/boss_death.mp3',
  'assets/audio/boss_theme.MP3',
  'assets/audio/breath_of_heaven.mp3',
  'assets/audio/button_click.mp3',
  'assets/audio/chain_impact.mp3',
  'assets/audio/chains_break.mp3',
  'assets/audio/chest_open.mp3',
  'assets/audio/cyclone_strike.mp3',
  'assets/audio/deadly_reach_cast.mp3',
  'assets/audio/deadly_reach_end.mp3',
  'assets/audio/deadly_reach_impact.mp3',
  'assets/audio/divine_echo.mp3',
  'assets/audio/door_open.mp3',
  'assets/audio/dragon_land.mp3',
  'assets/audio/dragon_strike.mp3',
  'assets/audio/enemy_attack.mp3',
  'assets/audio/enemy_death.mp3',
  'assets/audio/enemy_hit.mp3',
  'assets/audio/exploding_palm.mp3',
  'assets/audio/fist_of_thunder.mp3',
  'assets/audio/flying_dragon.mp3',
  'assets/audio/flying_kick.mp3',
  'assets/audio/healing_pulse.mp3',
  'assets/audio/imprisoned_fists.mp3',
  'assets/audio/inner_sanctuary.mp3',
  'assets/audio/inventory_open.mp3',
  'assets/audio/item_pickup.mp3',
  'assets/audio/kick_impact.mp3',
  'assets/audio/kick_land.mp3',
  'assets/audio/level_up.mp3',
  'assets/audio/main_theme.mp3',
  'assets/audio/mark_applied.mp3',
  'assets/audio/massive_explosion.mp3',
  'assets/audio/mystic_ally.mp3',
  'assets/audio/player_death.mp3',
  'assets/audio/player_hit.mp3',
  'assets/audio/rapid_strike.mp3',
  'assets/audio/seven_sided_strike.mp3',
  'assets/audio/strike_complete.mp3',
  'assets/audio/thunder_echo.mp3',
  'assets/audio/thunder_strike.mp3',
  'assets/audio/water_dissipate.mp3',
  'assets/audio/water_impact.mp3',
  'assets/audio/wave_of_light.mp3',
  'assets/audio/wave_strike.mp3',
  'assets/audio/wind_dissipate.mp3',
  'assets/audio/wind_pull.mp3',
  'assets/effects/buddha.glb',
  'assets/effects/flying-dragon.glb',
  'assets/images/background.jpg',
  'assets/models/monk-v3.glb',
  'assets/models/monk.glb'
];

// File sizes in bytes for progress reporting
const FILE_SIZES =   {
    "": 33696,
    "manifest.json": 571,
    "css/animations.css": 916,
    "css/dialog.css": 545,
    "css/game-menu.css": 5419,
    "css/game.css": 265,
    "css/hud-manager.css": 13143,
    "css/icons.css": 718,
    "css/initial-loading.css": 873,
    "css/inventory.css": 7981,
    "css/loading-screen.css": 522,
    "css/main.css": 1255,
    "css/notifications.css": 2324,
    "css/orientation-message.css": 438,
    "css/performance-manager.css": 1496,
    "css/reset.css": 1275,
    "css/settings-menu.css": 20658,
    "css/skill-preview.css": 1780,
    "css/skill-selection.css": 7239,
    "css/skill-tree.css": 8621,
    "css/utilities.css": 3931,
    "css/variables.css": 802,
    "js/AudioManager.js": 22440,
    "js/CollisionManager.js": 12868,
    "js/DifficultyManager.js": 4858,
    "js/EffectsManager.js": 5211,
    "js/InputHandler.js": 15130,
    "js/PerformanceManager.js": 31689,
    "js/QuestManager.js": 18478,
    "js/UIComponent.js": 2476,
    "js/effects/EffectObjectPool.js": 25995,
    "js/entities/enemies/Enemy.js": 19247,
    "js/entities/enemies/EnemyManager.js": 31696,
    "js/entities/enemies/models/CorruptedTreantModel.js": 9617,
    "js/entities/enemies/models/DefaultModel.js": 2282,
    "js/entities/enemies/models/DemonModel.js": 5915,
    "js/entities/enemies/models/EnemyModel.js": 3879,
    "js/entities/enemies/models/EnemyModelFactory.js": 4915,
    "js/entities/enemies/models/FireElementalModel.js": 6885,
    "js/entities/enemies/models/FrostElementalModel.js": 6995,
    "js/entities/enemies/models/FrostTitanModel.js": 7186,
    "js/entities/enemies/models/InfernalGolemModel.js": 4976,
    "js/entities/enemies/models/MountainTrollModel.js": 13144,
    "js/entities/enemies/models/NecromancerModel.js": 7426,
    "js/entities/enemies/models/ShadowBeastModel.js": 3457,
    "js/entities/enemies/models/SimpleEnemyModel.js": 5161,
    "js/entities/enemies/models/SkeletonArcherModel.js": 8968,
    "js/entities/enemies/models/SkeletonModel.js": 7301,
    "js/entities/enemies/models/SwampWitchModel.js": 13036,
    "js/entities/enemies/models/VoidWraithModel.js": 11929,
    "js/entities/enemies/models/ZombieBruteModel.js": 6416,
    "js/entities/enemies/models/ZombieModel.js": 4148,
    "js/entities/player/FallbackPlayerModel.js": 5656,
    "js/entities/player/Player.js": 7886,
    "js/entities/player/PlayerCombat.js": 14398,
    "js/entities/player/PlayerInterface.js": 4557,
    "js/entities/player/PlayerInventory.js": 2993,
    "js/entities/player/PlayerModel.js": 55444,
    "js/entities/player/PlayerMovement.js": 8229,
    "js/entities/player/PlayerSkills.js": 28393,
    "js/entities/player/PlayerState.js": 1428,
    "js/entities/player/PlayerStats.js": 7212,
    "js/entities/skills/BleedingEffect.js": 11889,
    "js/entities/skills/BreathOfHeavenEffect.js": 14617,
    "js/entities/skills/BulBreathOfHeavnEffect.js": 22629,
    "js/entities/skills/BulPalmEffect.js": 28873,
    "js/entities/skills/CycloneStrikeEffect.js": 16059,
    "js/entities/skills/DeadlyReachEffect.js": 14204,
    "js/entities/skills/ExplodingPalmEffect.js": 25429,
    "js/entities/skills/FistOfThunderEffect.js": 15442,
    "js/entities/skills/FlyingDragonEffect.js": 13620,
    "js/entities/skills/FlyingKickEffect.js": 10888,
    "js/entities/skills/ImprisonedFistsEffect.js": 20028,
    "js/entities/skills/InnerSanctuaryEffect.js": 18464,
    "js/entities/skills/MysticAllyEffect.js": 25597,
    "js/entities/skills/SevenSidedStrikeEffect.js": 19501,
    "js/entities/skills/ShieldOfZenEffect.js": 13809,
    "js/entities/skills/Skill.js": 9439,
    "js/entities/skills/SkillEffect.js": 3809,
    "js/entities/skills/SkillEffectFactory.js": 23124,
    "js/entities/skills/TeleportSkillEffect.js": 14179,
    "js/entities/skills/WaveOfLightEffect.js": 21310,
    "js/entities/skills/WaveStrikeEffect.js": 14073,
    "js/entities/skills/variants/BreathOfHeaven/CircleOfLifeEffect.js": 8194,
    "js/entities/skills/variants/BreathOfHeaven/InfusedWithLightEffect.js": 10005,
    "js/entities/skills/variants/BreathOfHeaven/RadiantBreathEffect.js": 6875,
    "js/entities/skills/variants/BreathOfHeaven/SoothingMistEffect.js": 11901,
    "js/entities/skills/variants/BreathOfHeaven/ZephyrsGraceEffect.js": 13678,
    "js/entities/skills/variants/CycloneStrike/EyeOfTheStormEffect.js": 11664,
    "js/entities/skills/variants/CycloneStrike/MysticWindsEffect.js": 15204,
    "js/entities/skills/variants/CycloneStrike/PathOfTheStormEffect.js": 15701,
    "js/entities/skills/variants/CycloneStrike/SandstormEffect.js": 12385,
    "js/entities/skills/variants/CycloneStrike/StormSpiritEffect.js": 14802,
    "js/entities/skills/variants/CycloneStrike/TempestRushEffect.js": 14786,
    "js/entities/skills/variants/CycloneStrike/TempestsHeartEffect.js": 13496,
    "js/entities/skills/variants/CycloneStrike/TornadoEffect.js": 12945,
    "js/entities/skills/variants/CycloneStrike/VortexEffect.js": 13282,
    "js/entities/skills/variants/CycloneStrike/backup/FrigidCycloneEffect.js": 11659,
    "js/entities/skills/variants/ExplodingPalm/BleedingPalmEffect.js": 11637,
    "js/entities/skills/variants/ExplodingPalm/BreathOfIncenseEffect.js": 18171,
    "js/entities/skills/variants/ExplodingPalm/ConcussivePalmEffect.js": 13839,
    "js/entities/skills/variants/ExplodingPalm/CripplingInsightEffect.js": 10811,
    "js/entities/skills/variants/ExplodingPalm/FieryPalmEffect.js": 16074,
    "js/entities/skills/variants/ExplodingPalm/IcyPalmEffect.js": 17082,
    "js/entities/skills/variants/ExplodingPalm/PathOfThePresentEffect.js": 32554,
    "js/entities/skills/variants/ExplodingPalm/ReachingRebukeEffect.js": 16241,
    "js/entities/skills/variants/ExplodingPalm/ScoldingStormEffect.js": 21682,
    "js/entities/skills/variants/ExplodingPalm/ShockingPalmEffect.js": 13982,
    "js/entities/skills/variants/FlyingDragon/DragonFlightEffect.js": 7894,
    "js/entities/skills/variants/FlyingDragon/GaleDragonEffect.js": 16125,
    "js/entities/skills/variants/FlyingDragon/InfernoDragonEffect.js": 15614,
    "js/entities/skills/variants/FlyingDragon/ShadowDragonEffect.js": 16989,
    "js/entities/skills/variants/FlyingDragon/ThunderDragonEffect.js": 19651,
    "js/entities/skills/variants/FlyingKick/BlazingKickEffect.js": 11039,
    "js/entities/skills/variants/FlyingKick/CycloneKickEffect.js": 7717,
    "js/entities/skills/variants/FlyingKick/GaleKickEffect.js": 7961,
    "js/entities/skills/variants/FlyingKick/GracesBountyEffect.js": 19383,
    "js/entities/skills/variants/FlyingKick/MantleOfTheCraneEffect.js": 17057,
    "js/entities/skills/variants/FlyingKick/MomentumFlowEffect.js": 22051,
    "js/entities/skills/variants/FlyingKick/ShadowKickEffect.js": 13669,
    "js/entities/skills/variants/FlyingKick/SpokesOfTheWheelEffect.js": 12233,
    "js/entities/skills/variants/FlyingKick/ThunderousKickEffect.js": 8599,
    "js/entities/skills/variants/FlyingKick/TigersFlightEffect.js": 18694,
    "js/entities/skills/variants/ImprisonedFists/FieryChainsEffect.js": 15451,
    "js/entities/skills/variants/ImprisonedFists/FrozenShacklesEffect.js": 12610,
    "js/entities/skills/variants/ImprisonedFists/GaleChainsEffect.js": 19235,
    "js/entities/skills/variants/ImprisonedFists/ShadowBindEffect.js": 17053,
    "js/entities/skills/variants/ImprisonedFists/ThunderousGripEffect.js": 19033,
    "js/entities/skills/variants/InnerSanctuary/CircleOfWrathEffect.js": 18540,
    "js/entities/skills/variants/InnerSanctuary/ForbiddenPalaceEffect.js": 15287,
    "js/entities/skills/variants/InnerSanctuary/SafeHavenEffect.js": 16656,
    "js/entities/skills/variants/InnerSanctuary/SanctifiedGroundEffect.js": 17614,
    "js/entities/skills/variants/InnerSanctuary/TempleOfProtectionEffect.js": 15813,
    "js/entities/skills/variants/MysticAllies/FireAlliesEffect.js": 17873,
    "js/entities/skills/variants/MysticAllies/WaterAlliesEffect.js": 23391,
    "js/entities/skills/variants/SevenSidedStrike/FistOfFuryEffect.js": 5158,
    "js/entities/skills/variants/SevenSidedStrike/InnerPeaceEffect.js": 11773,
    "js/entities/skills/variants/SevenSidedStrike/PandemoniumEffect.js": 9423,
    "js/entities/skills/variants/SevenSidedStrike/ShadowAssaultEffect.js": 12814,
    "js/entities/skills/variants/SevenSidedStrike/SustainedAssaultEffect.js": 5850,
    "js/entities/skills/variants/ShieldOfZen/DiamondAuraEffect.js": 10050,
    "js/entities/skills/variants/ShieldOfZen/RetributionAuraEffect.js": 19446,
    "js/entities/skills/variants/ShieldOfZen/SpiritualProtectionEffect.js": 15300,
    "js/entities/skills/variants/ShieldOfZen/TranscendenceEffect.js": 11153,
    "js/entities/skills/variants/WaveOfLight/ExplosiveLightEffect.js": 17390,
    "js/entities/skills/variants/WaveOfLight/LightningBellEffect.js": 19940,
    "js/entities/skills/variants/WaveOfLight/LightningBurstEffect.js": 19119,
    "js/entities/skills/variants/WaveOfLight/PillarOfTheLightEffect.js": 10810,
    "js/entities/skills/variants/WaveOfLight/PillarOfTheSunEffect.js": 20649,
    "js/entities/skills/variants/WaveOfLight/WallOfLightEffect.js": 22739,
    "js/entities/skills/variants/WaveStrike/FrozenWaveEffect.js": 20557,
    "js/entities/skills/variants/WaveStrike/ThunderWaveEffect.js": 26335,
    "js/entities/skills/variants/WaveStrike/TidalWaveEffect.js": 18146,
    "js/entities/utils/CharacterModelPool.js": 6803,
    "js/entities/utils/EnemyObjectPool.js": 6600,
    "js/game/Game.js": 29915,
    "js/game/GameEvents.js": 1148,
    "js/game/GameState.js": 1314,
    "js/game/LoadingManager.js": 1599,
    "js/game/SceneOptimizer.js": 4564,
    "js/hud-manager/DeathScreenUI.js": 1852,
    "js/hud-manager/DialogUI.js": 1843,
    "js/hud-manager/EnemyUI.js": 1842,
    "js/hud-manager/HUDManager.js": 14220,
    "js/hud-manager/HomeUI.js": 4118,
    "js/hud-manager/InventoryButton.js": 1863,
    "js/hud-manager/InventoryUI.js": 12891,
    "js/hud-manager/MiniMapButton.js": 2061,
    "js/hud-manager/MiniMapUI.js": 50767,
    "js/hud-manager/NotificationsUI.js": 18719,
    "js/hud-manager/PlayerUI.js": 3867,
    "js/hud-manager/QuestLogUI.js": 2709,
    "js/hud-manager/SkillSelectionButton.js": 4380,
    "js/hud-manager/SkillSelectionUI.js": 29311,
    "js/hud-manager/SkillTreeButton.js": 1867,
    "js/hud-manager/SkillTreeUI.js": 26754,
    "js/hud-manager/SkillsUI.js": 8306,
    "js/hud-manager/VirtualJoystickUI.js": 6963,
    "js/menu-system/ControlsDisplay.js": 8526,
    "js/menu-system/EnemyPreview.js": 12359,
    "js/menu-system/GameMenu.js": 10279,
    "js/menu-system/IMenu.js": 836,
    "js/menu-system/MainBackground.js": 1811,
    "js/menu-system/MenuManager.js": 5412,
    "js/menu-system/ModelPreview.js": 16289,
    "js/menu-system/SettingsMenu.js": 7721,
    "js/menu-system/SkillPreview.js": 27837,
    "js/menu-system/settings-menu/AudioTab.js": 5895,
    "js/menu-system/settings-menu/CharacterModelTab.js": 23021,
    "js/menu-system/settings-menu/ControlsTab.js": 1223,
    "js/menu-system/settings-menu/EnemyPreviewTab.js": 13083,
    "js/menu-system/settings-menu/GameplayTab.js": 2608,
    "js/menu-system/settings-menu/PerformanceTab.js": 7216,
    "js/menu-system/settings-menu/ReleaseTab.js": 3832,
    "js/menu-system/settings-menu/SettingsTab.js": 1400,
    "js/menu-system/settings-menu/SkillsPreviewTab.js": 9141,
    "js/menu-system/settings-menu/index.js": 533,
    "js/save-manager/ISaveSystem.js": 1255,
    "js/save-manager/IStorageAdapter.js": 1060,
    "js/save-manager/LocalStorageAdapter.js": 1831,
    "js/save-manager/SaveManager.js": 17997,
    "js/save-manager/serializers/PlayerSerializer.js": 4913,
    "js/save-manager/serializers/QuestSerializer.js": 3791,
    "js/save-manager/serializers/SettingsSerializer.js": 3440,
    "js/save-manager/utils/SaveOperationProgress.js": 6226,
    "js/services/InteractionResultHandler.js": 3849,
    "js/types.js": 8276,
    "js/utils/AnimationUtils.js": 10899,
    "js/utils/SkillTreeUtils.js": 3141,
    "js/utils/debug-utils.js": 1168,
    "js/world/WorldManager.js": 25544,
    "js/world/environment/Bush.js": 1849,
    "js/world/environment/EnvironmentManager.js": 21042,
    "js/world/environment/Flower.js": 4019,
    "js/world/environment/FogManager.js": 11408,
    "js/world/environment/Rock.js": 4594,
    "js/world/environment/Tree.js": 4528,
    "js/world/interactive/BossSpawnPoint.js": 1470,
    "js/world/interactive/InteractiveObjectManager.js": 15160,
    "js/world/interactive/QuestMarker.js": 8876,
    "js/world/interactive/TreasureChest.js": 6117,
    "js/world/lighting/LightingManager.js": 6719,
    "js/world/structures/Bridge.js": 14934,
    "js/world/structures/Building.js": 15301,
    "js/world/structures/DarkSanctum.js": 5009,
    "js/world/structures/Mountain.js": 14043,
    "js/world/structures/Ruins.js": 5086,
    "js/world/structures/StructureManager.js": 26102,
    "js/world/structures/Tower.js": 16012,
    "js/world/structures/Village.js": 21869,
    "js/world/teleport/TeleportManager.js": 59764,
    "js/world/terrain/TerrainManager.js": 48019,
    "js/world/utils/EnvironmentObjectPool.js": 6903,
    "js/world/utils/ModelObjectPool.js": 4476,
    "js/world/utils/ObjectPool.js": 6825,
    "js/world/utils/RandomGenerator.js": 2214,
    "js/world/utils/TerrainChunkPool.js": 4878,
    "js/world/utils/TextureGenerator.js": 4292,
    "js/world/zones/ZoneManager.js": 13789,
    "images/home.jpg": 141566,
    "images/logo-192.png": 15541,
    "images/logo-192.svg": 345,
    "images/logo-512.png": 62939,
    "images/logo-512.svg": 347,
    "assets/audio/ally_dismiss.mp3": 3456,
    "assets/audio/ally_summon.mp3": 2688,
    "assets/audio/attack.mp3": 2688,
    "assets/audio/barrier_dissipate.mp3": 4224,
    "assets/audio/barrier_form.mp3": 3456,
    "assets/audio/battle_theme.mp3": 40320,
    "assets/audio/bell_fade.mp3": 4224,
    "assets/audio/bell_ring.mp3": 5952,
    "assets/audio/boss_death.mp3": 5952,
    "assets/audio/boss_theme.mp3": 40320,
    "assets/audio/button_click.mp3": 1152,
    "assets/audio/chest_open.mp3": 2688,
    "assets/audio/cyclone_strike.mp3": 3456,
    "assets/audio/door_open.mp3": 3456,
    "assets/audio/enemy_attack.mp3": 1920,
    "assets/audio/enemy_death.mp3": 3456,
    "assets/audio/enemy_hit.mp3": 1152,
    "assets/audio/exploding_palm.mp3": 3456,
    "assets/audio/fist_of_thunder.mp3": 2688,
    "assets/audio/inner_sanctuary.mp3": 4992,
    "assets/audio/inventory_open.mp3": 1920,
    "assets/audio/item_pickup.mp3": 1920,
    "assets/audio/level_up.mp3": 3456,
    "assets/audio/main_theme.mp3": 585978,
    "assets/audio/mark_applied.mp3": 2688,
    "assets/audio/massive_explosion.mp3": 4992,
    "assets/audio/mystic_ally.mp3": 4224,
    "assets/audio/player_death.mp3": 4224,
    "assets/audio/player_hit.mp3": 1920,
    "assets/audio/rapid_strike.mp3": 1920,
    "assets/audio/seven_sided_strike.mp3": 4224,
    "assets/audio/strike_complete.mp3": 2688,
    "assets/audio/thunder_echo.mp3": 3456,
    "assets/audio/thunder_strike.mp3": 1920,
    "assets/audio/water_dissipate.mp3": 3456,
    "assets/audio/water_impact.mp3": 1920,
    "assets/audio/wave_of_light.mp3": 4992,
    "assets/audio/wave_strike.mp3": 2688,
    "assets/audio/wind_dissipate.mp3": 3456,
    "assets/audio/wind_pull.mp3": 2688,
    "assets/effects/buddha.glb": 55000, // Updated size for compressed Draco model
    "assets/images/background.jpg": 465241,
    "assets/models/monk-v3.glb": 155292,
    "assets/models/monk.glb": 366580
  };

// Function to send progress updates to the client
function sendProgressUpdate(completed, total, currentFile, loadedBytes, totalBytes) {
  if (messagePort) {
    messagePort.postMessage({
      type: 'CACHE_PROGRESS',
      completed,
      total,
      currentFile,
      loadedBytes,
      totalBytes,
      totalSizeMB: TOTAL_CACHE_SIZE_MB
    });
  }
}

// Communication channel
let messagePort = null;

// Listen for messages from the client
self.addEventListener('message', event => {
  // Check if it's the initialization message with the port
  if (event.data && event.data.type === 'INIT_PORT') {
    messagePort = event.data.port;
    console.debug('Communication channel established with client');
  }
});

// Function to cache files with progress tracking
async function cacheFilesWithProgress(cache) {
  const total = ASSETS_TO_CACHE.length;
  let completed = 0;
  let loadedBytes = 0;
  
  // Process files sequentially to ensure accurate progress tracking
  for (const url of ASSETS_TO_CACHE) {
    try {
      // Get file size (or 0 if not available)
      const fileSize = FILE_SIZES[url] || 0;
      
      // Send progress update before starting the fetch
      sendProgressUpdate(completed, total, url, loadedBytes, TOTAL_CACHE_SIZE_BYTES);
      
      // Handle empty URL (root path) specially
      const fetchUrl = url === '' ? './' : url;
      
      // Fetch and cache the file with proper request
      const request = new Request(fetchUrl, { method: 'GET' });
      const response = await fetch(request);
      
      if (response.ok) {
        await cache.put(url, response.clone());
        completed++;
        loadedBytes += fileSize;
        
        // Send progress update after successful caching
        sendProgressUpdate(completed, total, url, loadedBytes, TOTAL_CACHE_SIZE_BYTES);
      } else {
        console.warn(`Failed to cache ${url}: ${response.status} ${response.statusText}`);
        // Still increment completed to keep progress moving
        completed++;
        sendProgressUpdate(completed, total, `Failed: ${url}`, loadedBytes, TOTAL_CACHE_SIZE_BYTES);
      }
    } catch (error) {
      console.error(`Error caching ${url}:`, error);
      // Still increment completed to keep progress moving
      completed++;
      sendProgressUpdate(completed, total, `Error: ${url}`, loadedBytes, TOTAL_CACHE_SIZE_BYTES);
    }
  }
  
  return completed;
}

// Install event - cache all static assets with progress tracking
self.addEventListener('install', event => {
  event.waitUntil(
    caches.open(CACHE_KEY)
      .then(cache => {
        console.debug('Caching app assets with progress tracking');
        console.debug(`Total cache size: ${TOTAL_CACHE_SIZE_MB} MB with progress tracking`);
        return cacheFilesWithProgress(cache);
      })
      .then(completedCount => {
        console.debug(`Cached ${completedCount} files successfully`);
        return self.skipWaiting();
      })
      .catch(error => {
        console.error('Failed to cache assets:', error);
      })
  );
});

// Activate event - clean up old caches
self.addEventListener('activate', event => {
  event.waitUntil(
    caches.keys().then(cacheNames => {
      return Promise.all(
        cacheNames.filter(cacheName => {
          return cacheName.startsWith(CACHE_NAME) && cacheName !== CACHE_KEY;
        }).map(cacheName => {
          console.debug('Deleting old cache:', cacheName);
          return caches.delete(cacheName);
        })
      );
    }).then(() => {
      return self.clients.claim();
    })
  );
});

// Fetch event - serve from cache, fall back to network
self.addEventListener('fetch', event => {
  // Get the requested URL
  const requestUrl = new URL(event.request.url);
  
  // Handle root path specially
  const cacheKey = requestUrl.pathname === '/' ? '' : requestUrl.pathname;
  
  event.respondWith(
    caches.match(cacheKey)
      .then(response => {
        if (response) {
          return response;
        }
        return fetch(event.request);
      })
      .catch(error => {
        console.error('Fetch error:', error);
        // You could return a custom offline page here
      })
  );
});
